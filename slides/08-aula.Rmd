---
class: inverse 
title: "<b>Metodologias Informacionais com R</b>"
subtitle: "<br/>Modulo IV: PNAD Contínua do IBGE"
author: "<br/><b>Telmo dos Santos Klipp</b> (telmo.klipp@inpe.br)<br/>"
output:
  xaringan::moon_reader:
    css: [default, ninjutsu, ki-fonts, my-theme.css]
    yolo: false
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideClass: ["left", "top"]
      slideNumberFormat: "%current%"
      ratio: '16:9' # 
---
layout: true

background-image: url(figures/template_middlepage_2.png)
background-size: cover

```{r libririesandcustoms, include=FALSE, warning=FALSE}
  library(xaringanthemer)
  library(icons)
  colors = c(
    red = "#f34213",
    purple = "#3e2f5b",
    orange = "#ff8811",
    green = "#136f63",
    white = "#FFFFFF",
    midnightblue = "#191970"
  )
```

---
### .orange[`r icons::fontawesome("info-circle")` Informações Gerais sobre o Curso]

- <p class="jst">Materiais disponibilizados via <A href="https://classroom.google.com/u/0/c/NjExMjg5MTU0OTY3">Classroom</A>;</p> 
- <p class="jst">O aprendizado requer a prática que será constante nas aulas;</p>

.pull-left[
Bibliografia Básica:

 .tiny2[- <p class="jst">Kennedy, R., & Waggoner, P. D. (2021). Introduction to r for social scientists: a tidy programming approach. CRC Press.</p>

```{r out.width = '39%', echo=FALSE, fig.align = "center"}
knitr::include_graphics("figures/basicblibliograph.png") 
```
]
]

.pull-right[
Bibliografia Complementar:

 .tiny2[- <p class="jst">Wickham, H., Çetinkaya-Rundel, M., & Grolemund, G. (2023). R for data science (2e): import, tidy, transform, visualize, and model data. "O'Reilly Media, Inc.". Disponível em: <A href="https://r4ds.hadley.nz/">https://r4ds.hadley.nz/</A>. Acesso em: 14 de junho, 2023. (Online) </p>
- <p class="jst">Damiani, A. et. al., (2022). Ciência de Dados em R. Curso-R. Disponível em: <A href="https://livro.curso-r.com">https://livro.curso-r.com</A>. Acesso em: 12 de maio, 2023. (Online)</p>
-  <p class="jst">de Aquino, J. A. (2014). R para cientistas sociais. Editora da UESC (editus). Disponível em: <A href="http://www.uesc.br/editora/index.php?item=conteudo_livros_digitais.php">http://www.uesc.br/editora/</A>. Acesso em: 12 de maio, 2023. </p>
-  <p class="jst">de Oliveira, P. F., Guerra, S., McDonnell, R. (2018). Ciência de Dados com R: Introdução. Editora IBPAD. Disponível em: <A href="https://cdr.ibpad.com.br/index.html">https://cdr.ibpad.com.br/index.html</A>. Acesso em: 12 de maio, 2023. (Online) </p> ] 
]

---
### .orange[`r icons::fontawesome("table")`Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

<p class="jst">A <A href="https://www.ibge.gov.br/estatisticas/sociais/trabalho/17270-pnad-continua.html?=&t=o-que-e
">Pesquisa Nacional por Amostra de Domicílios Contínua (PNADC)</A>  realizada pelo Instituto Brasileiro de Geografia e Estatística (IBGE) visa:</p>

> <p class="jst"><i>"Acompanhar as flutuações trimestrais e a evolução, no curto, médio e longo prazos, da força de trabalho, e outras informações necessárias para o estudo do desenvolvimento socioeconômico do País."</i> (IBGE)</b> 

Algumas características da PNAD Contínua:

- <p class="jst">As pesquisas possuem periodicidade mensal (dada por trimestre móvel), trimestral, anual e variável (feita com maior periodicidade ou ocasionalmente).</p>
- <p class="jst">As pesquisas apresentam uma amostragem complexa.</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

<p class="jst">Para trabalhar com os microdados da PNAD Contínua vamos fazer uso dos pacotes: </p>

- <A href="https://cran.r-project.org/web/packages/PNADcIBGE/index.html">.purple[<b>PNADcIBGE</b>]</A> - possibilita baixar dados da PNAD Contínua.
- <A href="https://cran.r-project.org/web/packages/survey/index.html">.purple[<b>survey</b>]</A> - possibilita produzir diversas operações estatísticas em dados com amostragem complexa.
- <A href="https://cran.r-project.org/web/packages/srvyr/index.html">.purple[<b>srvyr</b>]</A> - uma extensão do pacote .purple[<b>survey</b>] que permite o uso de funções do .purple[<b>dplyr</b>] e sua sintaxe.


Para o momento é suficiente a instalação de:

```{r, message=FALSE, eval=FALSE}
  install.packages("PNADcIBGE") 
  install.packages("survey")
```

E carregar os referidos pacotes:

```{r, message=FALSE}
  library(PNADcIBGE)
  library(survey)
```

```{r, echo=FALSE}
options(OutDec=",", scipen=100, digits=4, big.mark = ".")
```


---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Permite a importação e a análise de dados amostrais (microdados) da PNAD Contínua do IBGE. A importação ou carregamento de dados pode ser feita de duas formas:</p>

- <b>Online</b> - usando a função  .purple[get_pnadc()]
  - <p class="jst">Observe <b>?get_pnadc</b></p>
  - <p class="jst">Na requisição dos microdados com .purple[get_pnadc()] são baixados arquivos de um servidor <b>FTP</b> do IBGE. Estes são: o arquivo com os microdados e os arquivos com a documentação necessária ao processamento e leitura desses dados (<i>input</i>, dicionários, indicadores de deflação).</p> 
- <b>Offline</b> - (dados previamente baixados) - usando a função  .purple[read_pnadc()]
  - <p class="jst">Observe <b>?read_pnadc</b></p>
  - <p class="jst">Essa função permite ler diretamente o arquivo contendo os microdados, dado um arquivo de <i>input</i> (um programa de leitura na linguagem SAS) fornecido pelo IBGE.</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

Existem divisões nos microdados da PNAD Contínua. Portanto, é possível baixá-los de quatro formas básicas:

- Dados trimestrais usando o parâmetro <b>quarter</b> que permite baixar um trimestre (1 à 4) por vez.
```{r, eval=FALSE}
  dados_2022q1 <- get_pnadc(year = 2022, quarter = 4)
```
- Dados anuais acumulados em determinada visita (entre a 1ª e 5ª cada vez) usando o parâmetro <b>interview</b>.
```{r, eval=FALSE}
  dados_2022_interview_1 <- get_pnadc(year = 2022, interview = 1)
```
- Dados anuais concentrados em determinado trimestre (entre o 1º e 4º cada vez) usando o parâmetro <b>topic</b>.
```{r, eval=FALSE}
  dados_2022_anual_trimestre <- get_pnadc(year=2022, topic=2)
```
- Dados de temas e tópicos suplementares (questionários específicos) aplicados a morador selecionado.
```{r, eval=FALSE}
  # Dados do módulo de Sensação de Segurança aplicado ao morador selecionado no 4º trimestre.
  dados_2022_anual_trimestre <- get_pnadc(year=2022, topic=4, selected=TRUE)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

Outros argumentos da função .purple[get_pnadc()] são:

- <b>vars</b>: Permite carregar no R apenas variáveis específicas (obs: não funciona exatamente como o esperado).

```{r, eval=FALSE}
  # Obtendo as  variáveis:
  #  VD4001 - Condição em relação à força de trabalho
  #  VD4002 - Condição de ocupação
  dados_2022q1 <- get_pnadc(year = 2022, quarter = 4, vars=c("VD4001","VD4002"))
```
- <b>labels</b> (lógico `TRUE` ou `FALSE`): incluir ou não nomes categóricos nos valores de determinadas variáveis.

- <b>deflator</b> (lógico `TRUE` ou `FALSE`): incluir ou não as variáveis que permitem aplicar deflacionamento.

- <b>design</b> (lógico `TRUE` ou `FALSE`): retorna ou não os dados como objeto do tipo <b>`svyrep.design`</b>.

- <b>defyear</b> e <b>defperiod</b>: Ano ou trimestre considerados nas variáveis de deflacionamento, respectivamente. Se <b>defyear</b> ou <b>defperiod</b> forem indicados como `NULL` e o <b>deflator</b> como `TRUE`, serão considerado o ano mais recente, o ano ou o trimestre dos dados, conforme a alternativa de requisição de dados usada.

- <b>savedir</b>: Diretório para salvar os microdados e a documentação necessária ao processamento e leitura.

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Vamos trabalhar com microdados do primeiro trimestre de 2023. Para baixar os dados de um trimestre do servidor do IBGE através do pacote .purple[<b>PNADcIBGE</b>], procedemos na forma:</p>

```{r, cache=TRUE, eval=FALSE}
  pnadc_2023q1 <- get_pnadc(year = 2023, quarter = 1)
```

<p class="jst">Lembrando que como se trata de uma quantidade considerável de dados, podemos escolher carregar apenas variáveis específicas como a condição de ocupação (<b>VD4002</b>):</p>

```{r, eval=FALSE}
  desocupacao_2023q1 <- get_pnadc(year = 2023, quarter = 1, vars = "VD4002")
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Conforme mencionado, é possível carregar dados da PNAD Contínua diretamente (<i>offline</i>) com a função .purple[read_pnadc()], caso os dados já tenham sido baixados para o computador. Para isso basta informar o arquivo dos microdados (ex: PNADC_012023.txt) e o arquivo de <i>input</i> (um programa de leitura em SAS).</p>

```{r cache=TRUE, include=FALSE}
  # Lendo algumas variáveis
  pnadc_2023q1 <- read_pnadc(microdata="../dados/PNADC20231/PNADC_012023.txt",
                             input_txt="../dados/PNADC20231/input_PNADC_trimestral.txt",
                             vars = c("Ano", "Trimestre", "UF", "Capital", 
                                      "V2009", "VD3005", "VD4002"))
  class(pnadc_2023q1)
```

```{r, cache=TRUE, eval=FALSE}
  # Lendo algumas variáveis
  pnadc_2023q1 <- read_pnadc(microdata="PNADC20231/PNADC_012023.txt",
                             input_txt="PNADC20231/input_PNADC_trimestral.txt",
                             vars = c("Ano", "Trimestre", "UF", "Capital", 
                                      "V2009", "VD3005", "VD4002"))
  class(pnadc_2023q1)
```

<p class="jst">Nesse caso, os dados serão retornados em um objeto do tipo <b>tibble</b>, sendo necessário aplicar outras operações aos dados para obter <i>labels</i> categóricos em determinadas variáveis, as variáveis de deflacionamento, bem como, transformar o objeto do tipo <b>tibble</b> para <b>svyrep.design</b>, caso seja de interesse obter estatísticas considerando o plano amostral com o pacote .purple[<b>survey</b>]. Essas operações são possíveis através das funções .purple[pnadc_labeller()], .purple[pnadc_deflator()] e  .purple[pnadc_design()] ...</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">... Dessa forma, para obter os <i>labels</i> categóricos, as variáveis de deflacionamento e produzir um objeto do tipo <b>svyrep.design</b> procedemos com:</p>

```{r cache=TRUE, include=FALSE}
  # Atribuindo labels as variáveis categóricas
  pnadc_2023q1 <- pnadc_labeller(
    data_pnadc=pnadc_2023q1,
    dictionary.file="../dados/PNADC20231/dicionario_PNADC_microdados_trimestral.xls"
  )
  # Carregando indicadores de deflação caso deseja-se obter variáveis de rendimento
  # em valor real.
  pnadc_2023q1 <- pnadc_deflator(
    data_pnadc=pnadc_2023q1,
    deflator.file="../dados/PNADC20231/deflator_PNADC_2023_trimestral_040506.xls"
  )
  # Criação do plano amostral para obter estatísticas coerentes com pacote 'survey'
  pnadc_2023q1 <- pnadc_design(data_pnadc=pnadc_2023q1)
```

```{r cache=TRUE, eval=FALSE}
  # Atribuindo labels as variáveis categóricas
  pnadc_2023q1 <- pnadc_labeller(
    data_pnadc=pnadc_2023q1,
    dictionary.file="PNADC20231/dicionario_PNADC_microdados_trimestral.xls"
  )
  # Carregando indicadores de deflação caso deseja-se obter variáveis de rendimento
  # em valor real.
  pnadc_2023q1 <- pnadc_deflator(
    data_pnadc=pnadc_2023q1,
    deflator.file="PNADC20231/deflator_PNADC_2023_trimestral_040506.xls"
  )
  # Criação do plano amostral para obter estatísticas coerentes com pacote 'survey'
  pnadc_2023q1 <- pnadc_design(data_pnadc=pnadc_2023q1)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Os arquivos de microdados e auxiliares (input, dicionários, indicadores de deflação) usados para aplicar as operações anteriores são fornecidos pelo IBGE.</p>

<p class="jst">Esses arquivos podem ser obtidos no <A href="https://www.ibge.gov.br/estatisticas/sociais/trabalho/17270-pnad-continua.html?=&t=downloads">.purple[site]</A> ou em servidor <b>ftp</b> do IBGE (<A href="https://ftp.ibge.gov.br">.purple[https://ftp.ibge.gov.br]</A>).</p>

<p class="jst">No entanto, é muito mais comodo obtê-los fazendo uma requisição com a função .purple[get_pnadc()]. Nesse caso, não é necessário procurar os dados desejados na hierarquia de pastas do referido site ou do servidor <b>ftp</b>.</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Após as operações realizadas, nosso objeto passa a ser do tipo <b>svyrep.design</b>:</p>

```{r, cache=TRUE, eval=TRUE}
  class(pnadc_2023q1)
```

Esse objeto é uma lista cujos elementos são:

```{r, cache=TRUE, eval=TRUE}
  names(pnadc_2023q1)
```

No item "variables" está o objeto <b>tibble</b> com os microdados. Os nomes das variáveis disponíveis podem ser obtidos com:

```{r, cache=TRUE, eval=FALSE}
  names(pnadc_2023q1$variables)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Relembrando:</p>

- A função  .purple[get_pnadc()] permite:
  - <p class="jst">Baixar os dados de servidor <b>FTP</b>.</p>
  - <p class="jst">Inclui por padrão <i>labels</i> categóricos, variáveis de deflacionamento e plano amostral. A não inclusão requer o uso de parâmetros específicos da função.</p> 
- A função  .purple[read_pnadc()] permite:
  - <p class="jst">Ler os microdados, requerendo arquivos específicos.</p>
  - <p class="jst">A inclusão de <i>labels</i> categóricos, variáveis de deflacionamento e plano amostral requer o uso de funções auxiliares.</p>


---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst"> O plano amostral obtido com o objeto do tipo <b>svyrep.design</b> é necessário para obter estatísticas coerentes e métricas sobre essas estatísticas como intervalos de confiança e margem de erro. Para maiores informações, veja as seguintes vídeo-aulas sobre microdados:</p>

- <A href="https://youtu.be/k3rLK8V_38s">.purple[Vídeo 1 - teórico]</A>

- <A href="https://www.youtube.com/watch?v=qC22jz0FA0U">.purple[Vídeo 2 - sobre PNADC]</A>

- <A href="https://www.youtube.com/watch?v=hhNA8MR__aA">.purple[Vídeo 3 - sobre Pesquisa de Orçamentos Familiares (POF)]</A>

<p class="jst"> O plano amostral da PNAD Contínua considera dois estágios de seleção com <b>estratificação</b> das unidades primárias de amostragem (UPAs). Não obstante, para produzir estatísticas coerentes sobre os dados, temos algumas opções:</p>

- <p class="jst">Usar o pacote .purple[<b>survey</b>], porém, seu objeto do tipo lista não permitirá operações usando o .purple[<b>dplyr</b>], devendo-se usar outras opções para manipulação de dados.</p>
- <p class="jst">Considerar as devidas métricas do plano amostral como, por exemplo, aplicar manualmente os devidos pesos da estratificação em funções pertinentes para gerar as estatíticas desejadas.</p>
- <p class="jst">Usar de forma combinada o pacote .purple[<b>survey</b>] e .purple[<b>srvyr</b>] o que permitirá o uso de funções do .purple[<b>dplyr</b>] e consequente flexibilidade nas manipulações de dados.</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

<p class="jst">O objeto <b>svyrep.design</b> permite produzir estatísticas através de funções do pacote .purple[<b>survey</b>]. Vejamos:</p>

Qual a taxa de Ocupados/Desocupados em nível nacional?

```{r, cache=TRUE}
  svymean(~VD4002, pnadc_2023q1, na.rm=T)
```

Como gerar intervalos de confiança da proporção de Ocupados/Desocupados?

```{r, cache=TRUE}
  confint(svymean(~VD4002, pnadc_2023q1, na.rm=T), level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

Qual a taxa de Ocupados/Desocupados no Rio Grande do Sul?

```{r, cache=TRUE}
  svymean(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T)
```

Como gerar intervalos de confiança da proporção de Ocupados/Desocupados?

```{r, cache=TRUE}
  confint(svymean(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T), level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

Qual o total de Ocupados/Desocupados no Rio Grande do Sul?

```{r, cache=TRUE}
  svytotal(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T)
```

Como gerar intervalos de confiança do total de Ocupados/Desocupados?

```{r, cache=TRUE}
  confint(svytotal(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T), level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

<p class="jst">A variável <b>V2009</b> refere-se a idade dos entrevistados, enquanto <b>VD3005</b> refere-se a quantidade de anos de estudo. Portanto, qual é a média de anos de estudos da população de 25 anos ou mais de idade no Rio Grande do Sul?</p>

```{r, cache=TRUE}
  svymean(~as.numeric(gsub("\\D", "", VD3005)), 
          subset(pnadc_2023q1, V2009 >= 25, UF=='Rio Grande do Sul'), na.rm = T)
```

```{r, cache=TRUE}
  confint(svymean(~as.numeric(gsub("\\D", "", VD3005)),
                  subset(pnadc_2023q1, V2009 >= 25, UF=='Rio Grande do Sul'), na.rm = T),
          level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

 Qual é a média de anos de estudos da população de 25 anos ou mais de idade na capital Porto Alegre?
 
```{r, cache=TRUE}
  svymean(~as.numeric(gsub("\\D", "", VD3005)),
          subset(pnadc_2023q1,
                 V2009 >= 25 & Capital=="Município de Porto Alegre (RS)"), na.rm = T)
```

```{r, cache=TRUE}
  confint(svymean(~as.numeric(gsub("\\D", "", VD3005)), 
                  subset(pnadc_2023q1,
                         V2009 >= 25 & Capital=="Município de Porto Alegre (RS)"), na.rm = T),
          level=.99)
```
 
---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

Nos próximos exemplos trabalharemos com os seguintes dados:

```{r, eval=FALSE}
  pnadc2023_1trim <- get_pnadc(2023, quarter = 1, design = FALSE, labels = T, 
                             vars = c("Ano","Trimestre","UF", "RM_RIDE", "Capital","UPA",
                                      "Estrato","V1028", "V2007","V2009","V2010","V3007",
                                      "VD3004", "VD3005","VD4001", "VD4002","VD4005"
                                      "Habitual", "Efetivo"))
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

Para carregar diretamente:

```{r cache=TRUE, include=FALSE}
  pnadc2023_1trim <- read_pnadc(microdata="../dados/PNADC20231/PNADC_012023.txt",
                             input_txt="../dados/PNADC20231/input_PNADC_trimestral.txt",
                             vars = c("Ano","Trimestre","UF", "RM_RIDE", "Capital","UPA",
                                      "Estrato","V1028", "V2007","V2009","V2010","V3007",
                                      "VD3004", "VD3005","VD4001", "VD4002","VD4005",
                                      "VD4019","VD4020","VD4035"))
  pnadc2023_1trim <- pnadc_labeller(
    data_pnadc=pnadc2023_1trim,
    dictionary.file="../dados/PNADC20231/dicionario_PNADC_microdados_trimestral.xls"
  )
  pnadc2023_1trim <- pnadc_deflator(
    data_pnadc=pnadc2023_1trim,
    deflator.file="../dados/PNADC20231/deflator_PNADC_2023_trimestral_040506.xls"
  )
```

```{r cache=TRUE, eval=FALSE}
  pnadc2023_1trim <- read_pnadc(microdata="PNADC20231/PNADC_012023.txt",
                             input_txt="PNADC20231/input_PNADC_trimestral.txt",
                             vars = c("Ano","Trimestre","UF", "RM_RIDE", "Capital","UPA",
                                      "Estrato","V1028", "V2007","V2009","V2010","V3007",
                                      "VD3004", "VD3005","VD4001", "VD4002","VD4005",
                                      "VD4019","VD4020","VD4035"))
  pnadc2023_1trim <- pnadc_labeller(
    data_pnadc=pnadc2023_1trim,
    dictionary.file="PNADC20231/dicionario_PNADC_microdados_trimestral.xls"
  )
  pnadc2023_1trim <- pnadc_deflator(
    data_pnadc=pnadc2023_1trim,
    deflator.file="PNADC20231/deflator_PNADC_2023_trimestral_040506.xls"
  )
```

```{r, message=FALSE}
  library(tidyverse)
  library(kableExtra)
  library(patchwork)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

```{r, cache=TRUE}
  rendimento_mensal_estados <- pnadc2023_1trim |>
    mutate(anos_de_estudo = as.numeric(gsub("\\D", "", VD3005))) |>
    summarise("rendimento_medio" = weighted.mean(VD4020, w = V1028, na.rm = TRUE),
              "anos_de_estudo" = weighted.mean(anos_de_estudo, w = V1028, na.rm = TRUE),
              .by = "UF") |>
    drop_na() |>
    arrange(desc(rendimento_medio))
  rendimento_mensal_estados |> kable() |> 
    kable_styling(bootstrap_options = c('striped', 'condensed')) |>
    scroll_box(width = "1050px", height = "250px")
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

.pull-left[
<p class="jst">Rendimento médio mensal e anos de estudo por estados.</p>

```{r p1a, message=FALSE, eval=FALSE}
  dt <- rendimento_mensal_estados |>
    mutate(
      UF=fct_reorder(UF,
                          rendimento_medio)
    )
   p <- ggplot(dt) + theme_classic()
   p1 <- p + geom_col(aes(rendimento_medio,
                          UF))
   p2 <- p + geom_col(aes(anos_de_estudo,
                          UF)) +
     theme(axis.text.y = element_blank(),
           axis.title.y = element_blank())
   p1 + p2
```
]

.pull-right[
```{r p1a_out, ref.label="p1a", echo=FALSE, warning=FALSE, message=FALSE}
```
]

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

.pull-left[
<p class="jst">Rendimento médio mensal por anos de estudo em nível estadual.</p>
```{r p1b, message=FALSE, eval=FALSE}
  rendimento_mensal_estados |> 
    ggplot(aes(anos_de_estudo,
               rendimento_medio)) +
    geom_point() + theme_classic()
```
]

.pull-right[
```{r p1b_out, ref.label="p1b", echo=FALSE, warning=FALSE, message=FALSE}
```
]

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

```{r, cache=TRUE}
  rendimento_mensal_capitais <- pnadc2023_1trim |>
    mutate(anos_de_estudo = as.numeric(gsub("\\D", "", VD3005))) |>
    summarise("rendimento_medio" = weighted.mean(VD4020, w = V1028, na.rm = TRUE),
              "anos_de_estudo" = weighted.mean(anos_de_estudo, w = V1028, na.rm = TRUE),
              .by = "Capital") |>
    tidyr::drop_na() |>
    arrange(desc(rendimento_medio))
  rendimento_mensal_capitais |> kable() |> 
    kable_styling(bootstrap_options = c('striped', 'condensed')) |>
    scroll_box(width = "1050px", height = "250px")
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

.pull-left[
<p class="jst">Rendimento médio mensal e anos de estudo nas capitais.</p>
```{r p2a, message=FALSE, eval=FALSE}
  dt <- rendimento_mensal_capitais |>
    mutate(
      Capital=fct_reorder(Capital,
                          rendimento_medio)
    )
   p <- ggplot(dt) + theme_classic()
   p1 <- p + geom_col(aes(rendimento_medio,
                          Capital))
   p2 <- p + geom_col(aes(anos_de_estudo,
                          Capital)) +
     theme(axis.text.y = element_blank(),
           axis.title.y = element_blank())
   p1 + p2 
```
]

.pull-right[
```{r p2a_out, ref.label="p2a", echo=FALSE, warning=FALSE, message=FALSE}
```
]

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas manualmente]

.pull-left[
<p class="jst">Rendimento médio mensal por anos de estudo considerando as capitais.</p>
```{r p2b, message=FALSE, eval=FALSE}
  rendimento_mensal_capitais |> 
    ggplot(aes(anos_de_estudo,
               rendimento_medio)) +
    geom_point() + theme_classic()
```
]

.pull-right[
```{r p2b_out, ref.label="p2b", echo=FALSE, warning=FALSE, message=FALSE}
```
]

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>srvyr</b>]]

Vamos usar de forma combinada .purple[<b>survey</b>] e .purple[<b>srvyr</b>]. Antes, necessitamos instalar e carregar o pacote .purple[<b>srvyr</b>]:

```{r, message=FALSE, eval=FALSE}
  install.packages("srvyr")
```

```{r, message=FALSE}
  library(srvyr)
```

Agora aplicaremos o plano amostral nos nossos dados:

```{r, message=FALSE}
  pnadc2023_1trim <- pnadc_design(data_pnadc=pnadc2023_1trim)
  class(pnadc2023_1trim)
```

E tranformaremos novamente o objeto, conforme:

```{r, message=FALSE}
  pnadc2023_1trim <- srvyr::as_survey(pnadc2023_1trim)
  class(pnadc2023_1trim)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>srvyr</b>]]

Esse objeto continua sendo uma lista cujos elementos são:

```{r, cache=TRUE, eval=TRUE}
  names(pnadc2023_1trim)
```

No item "variables" está o objeto <b>tibble</b> com os microdados, as variáveis disponíveis são:

```{r, cache=TRUE, eval=FALSE}
  names(pnadc2023_1trim$variables)
```

Observe que é possível usar funções do pacote .purple[<b>dplyr</b>] no novo objeto:

```{r, cache=TRUE, eval=FALSE}
  glimpse(pnadc2023_1trim)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>srvyr</b>]]

```{r, cache=TRUE}
rendimento_mensal_estados <- pnadc2023_1trim |>
  group_by(UF) |>
  summarise(rendimento_medio = survey_mean(VD4020, na.rm = T, vartype = "ci"))
rendimento_mensal_estados |> kable() |> 
  kable_styling(bootstrap_options = c('striped', 'condensed')) |>
  scroll_box(width = "1050px", height = "250px")
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>srvyr</b>]]

.pull-left[
<p class="jst">Rendimento médio mensal por estados.</p>
```{r p3a, message=FALSE, eval=FALSE}
  rendimento_mensal_estados |> 
    ggplot(aes(UF, rendimento_medio)) +
    geom_point() +
    geom_errorbar(
      aes(ymin = rendimento_medio_low,
          ymax = rendimento_medio_upp),
      width = 0.2) +
    theme_classic() +
    theme(
      axis.text.x = element_text(angle = 90)
    )
```
]

.pull-right[
```{r p3a_out, ref.label="p3a", echo=FALSE, warning=FALSE, message=FALSE}
```
]

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>srvyr</b>]]


```{r, cache=TRUE}
  proporcao_nivel_estudo <- pnadc2023_1trim |>
    group_by(V2007, VD3004) |>
    summarise(frequencia = survey_mean())
  proporcao_nivel_estudo |> kable() |> 
    kable_styling(bootstrap_options = c('striped', 'condensed')) |>
    scroll_box(width = "1050px", height = "250px")
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>srvyr</b>]]

.pull-left[
<p class="jst">Proporção da população, estre os entrevistados, em cada nível de estudo.</p>
```{r p4a, message=FALSE, eval=FALSE}
  proporcao_nivel_estudo |> 
    mutate(
      nivel_de_estudo = fct_reorder(
        VD3004, frequencia
      )
    ) |>
    drop_na() |>
    ggplot(aes(frequencia,
               nivel_de_estudo)) +
    geom_col() +
    facet_wrap(~V2007, nrow = 2) +
    theme_classic()
```
]

.pull-right[
```{r p4_out, ref.label="p4a", echo=FALSE, warning=FALSE, message=FALSE}
```
]

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>srvyr</b>]]

<b>Exercício:</b>

Gere o rendimento médio mensal por estado e segundo a variável <b>V2007</b> usando o pacote .purple[<b>srvyr</b>]. Faça isso considerando operações do .purple[<b>dplyr</b>].

```{r, cache=TRUE, include=FALSE}
  rendimento_mensal <- pnadc2023_1trim |>
    mutate(anos_de_estudo = as.numeric(gsub("\\D", "", VD3005))) |> 
    group_by(UF, V2007) |>
    summarise("rendimento_medio" = survey_mean(VD4020, na.rm = TRUE),
              "anos_de_estudo" = survey_mean(anos_de_estudo, na.rm = TRUE),
    ) |>
    tidyr::drop_na() |>
    arrange(desc(rendimento_medio))
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

<p class="jst">Há uma diversidade de bons materiais que orientam o uso dos microdados da PNAD Contínua através do R: </p>

- <p class="jst">Material <A href="https://rpubs.com/gabriel-assuncao-ibge/pnadc">.purple[online]</A> desenvolvido por um dos criadores do pacote .purple[<b>PNADcIBGE</b>].

- <p class="jst"> Livro  <A href="https://repositorio.ufrn.br/bitstream/123456789/48507/1/PorDentrodaPNADContinua_Trov%C3%A3o_SilvaJ%C3%BAnior_2022.pdf">.purple["POR DENTRO DA PNAD CONTÍNUA: Uma introdução ao tratamento de dados usando o R"]</A>.
- <p class="jst">Curso de R disponível no repositório do Git Hub: <A href="https://github.com/leobarone/cebrap_lab_cetic_programacao_r/tree/master">.purple[Introdução à Programação em R]</b></A>. 
- <p class="jst">Material <A href="https://rpubs.com/amrofi/microdados_pnadc_srvyr/">.purple[online]</A>.

---
exclude: TRUE
class: left, top

### .orange[Referências]

```{r, load_refs, echo=FALSE}
library(RefManageR)
bib <- ReadBib("./files/02-mybib.bib", check = FALSE)
generateReferences <- function(bib) {
  for(i in 1:length(bib)) { 
    print(bib[i], .opts = list(check.entries = FALSE, style = "html", bib.style = "authoryear"))
  }
}
```

```{r, print_refs, results='asis', echo=FALSE, warning=FALSE, message=FALSE}
writeLines('.small[')
generateReferences(bib)
writeLines(']')
```

---
class: center, middle

background-image: url(figures/template_endpage_2.png)
background-size: contain

.center[.large[<b> Metotologias Informacionais com `r icon_style( icons::simple_icons("r"), scale = 2)`</b> ]]

.xxlarge[<b style="color:MidnightBlue "> Muito Obrigado pela Atenção!</b>]
  
