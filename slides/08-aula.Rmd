---
class: inverse 
title: "<b>Metodologias Informacionais com R</b>"
subtitle: "<br/>Modulo IV: PNAD Contínua do IBGE"
author: "<br/><b>Telmo dos Santos Klipp</b> (telmo.klipp@inpe.br)<br/>"
output:
  xaringan::moon_reader:
    css: [default, ninjutsu, ki-fonts, my-theme.css]
    yolo: false
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideClass: ["left", "top"]
      slideNumberFormat: "%current%"
      ratio: '16:9' # 
---
layout: true

background-image: url(figures/template_middlepage_2.png)
background-size: cover

```{r libririesandcustoms, include=FALSE, warning=FALSE}
  library(xaringanthemer)
  library(icons)
  colors = c(
    red = "#f34213",
    purple = "#3e2f5b",
    orange = "#ff8811",
    green = "#136f63",
    white = "#FFFFFF",
    midnightblue = "#191970"
  )
```

---
### .orange[`r icons::fontawesome("info-circle")` Informações Gerais sobre o Curso]

- <p class="jst">Materiais disponibilizados via <A href="https://classroom.google.com/u/0/c/NjExMjg5MTU0OTY3">Classroom</A>;</p> 
- <p class="jst">O aprendizado requer a prática que será constante nas aulas;</p>

.pull-left[
Bibliografia Básica:

 .tiny2[- <p class="jst">Kennedy, R., & Waggoner, P. D. (2021). Introduction to r for social scientists: a tidy programming approach. CRC Press.</p>

```{r out.width = '39%', echo=FALSE, fig.align = "center"}
knitr::include_graphics("figures/basicblibliograph.png") 
```
]
]

.pull-right[
Bibliografia Complementar:

 .tiny2[- <p class="jst">Wickham, H., Çetinkaya-Rundel, M., & Grolemund, G. (2023). R for data science (2e): import, tidy, transform, visualize, and model data. "O'Reilly Media, Inc.". Disponível em: <A href="https://r4ds.hadley.nz/">https://r4ds.hadley.nz/</A>. Acesso em: 14 de junho, 2023. (Online) </p>
- <p class="jst">Damiani, A. et. al., (2022). Ciência de Dados em R. Curso-R. Disponível em: <A href="https://livro.curso-r.com">https://livro.curso-r.com</A>. Acesso em: 12 de maio, 2023. (Online)</p>
-  <p class="jst">de Aquino, J. A. (2014). R para cientistas sociais. Editora da UESC (editus). Disponível em: <A href="http://www.uesc.br/editora/index.php?item=conteudo_livros_digitais.php">http://www.uesc.br/editora/</A>. Acesso em: 12 de maio, 2023. </p>
-  <p class="jst">de Oliveira, P. F., Guerra, S., McDonnell, R. (2018). Ciência de Dados com R: Introdução. Editora IBPAD. Disponível em: <A href="https://cdr.ibpad.com.br/index.html">https://cdr.ibpad.com.br/index.html</A>. Acesso em: 12 de maio, 2023. (Online) </p> ] 
]

---
### .orange[`r icons::fontawesome("table")`Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

<p class="jst">A <A href="https://www.ibge.gov.br/estatisticas/sociais/trabalho/17270-pnad-continua.html?=&t=o-que-e
">Pesquisa Nacional por Amostra de Domicílios Contínua (PNADC)</A>  realizada pelo Instituto Brasileiro de Geografia e Estatística (IBGE) visa:</p>

> <p class="jst"><i>"Acompanhar as flutuações trimestrais e a evolução, no curto, médio e longo prazos, da força de trabalho, e outras informações necessárias para o estudo do desenvolvimento socioeconômico do País."</i> (IBGE)</b> 

Algumas características da PNAD Contínua:

- <p class="jst">As pesquisas possuem periodicidade mensal (dada por trimestre móvel), trimestral, anual e variável (feita com maior periodicidade ou ocasionalmente).</p>
- <p class="jst">As pesquisas apresentam uma amostragem complexa.</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

<p class="jst">Para trabalhar com os microdados da PNAD Contínua vamos fazer uso dos pacotes: </p>

- <A href="https://cran.r-project.org/web/packages/PNADcIBGE/index.html">.purple[<b>PNADcIBGE</b>]</A> - possibilita baixar dados da PNAD Contínua.
- <A href="https://cran.r-project.org/web/packages/survey/index.html">.purple[<b>survey</b>]</A> - possibilita produzir diversas operações estatísticas em dados com amostragem complexa.
- <A href="https://cran.r-project.org/web/packages/srvyr/index.html">.purple[<b>srvyr</b>]</A> - uma extensão do pacote .purple[<b>survey</b>] que permite o uso de funções do .purple[<b>dplyr</b>] e sua sintaxe.


Para o momento é suficiente a instalação de:

```{r p2b, message=FALSE, eval=FALSE}
  install.packages("PNADcIBGE") 
  install.packages("survey")
```

E carregar os referidos pacotes:

```{r, message=FALSE}
  library(PNADcIBGE)
  library(survey)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Permite a importação e a análise de dados amostrais (microdados) da PNAD Contínua do IBGE. A importação de dados pode ser feita de duas formas:</p>

- <b>Online</b> - usando a função  .purple[get_pnadc()]
  - Observe <b>?get_pnadc</b>
- <b>Offline</b> - (dados previamente baixados) - usando a função  .purple[read_pnadc()]
  - Observe <b>?read_pnadc</b>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

Existem divisões nos microdados da PNAD Contínua. Portanto, é possível baixá-los de quatro formas básicas:

- Dados trimestrais usando o parâmetro <b>quarter</b> que permite baixar um trimestre (1 à 4) por vez.
```{r, eval=FALSE}
  dados_2022q1 <- get_pnadc(year = 2022, quarter = 4)
```
- Dados anuais acumulados em determinada visita (entre 1 e 5 por vez) usando o parâmetro <b>interview</b>.
```{r, eval=FALSE}
  dados_2022_interview_1 <- get_pnadc(year = 2022, interview = 1)
```
- Dados anuais concentrados em determinado trimestre (entre 1 e 4 por vez) usando o parâmetro <b>topic</b>.
```{r, eval=FALSE}
  dados_2022_anual_trimestre <- get_pnadc(year=2022, topic=2)
```
- Dados de temas e tópicos suplementares (questionários específicos) aplicados a morador selecionado.
```{r, eval=FALSE}
  # Dados do módulo de Sensação de Segurança aplicado ao morador selecionado no 4º trimestre.
  dados_2022_anual_trimestre <- get_pnadc(year=2022, topic=4, selected=TRUE)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

Outros argumentos da função .purple[get_pnadc()] são:

- <b>vars</b>: Permite baixar variáveis específicas.

```{r, eval=FALSE}
  # Obtendo as  variáveis:
  #  VD4001 - Condição em relação à força de trabalho
  #  VD4002 - Condição de ocupação
  dados_2022q1 <- get_pnadc(year = 2022, quarter = 4, vars=c("VD4001","VD4002"))
```
- <b>labels</b> (lógico `TRUE` ou `FALSE`): incluir ou não nomes categóricos nos valores de determinadas variáveis.

- <b>deflator</b> (lógico `TRUE` ou `FALSE`): incluir ou não as variáveis que permitem aplicar deflacionamento.

- <b>design</b> (lógico `TRUE` ou `FALSE`): retorna ou não os dados como <b>`survey.design/svyrep.design`</b>.

- <b>defyear</b> e <b>defperiod</b>: Ano ou trimestre considerados nas variáveis de deflacionamento, respectivamente. Se <b>defyear</b> ou <b>defperiod</b> forem indicados como `NULL` e o <b>deflator</b> como `TRUE`, será considerado o ano mais recente, o ano ou, o trimestre dos dados conforme a alternativa de requisição de dados usada.

- <b>savedir</b>: Diretório para salvar os microdados e a documentação necessária ao processamento e leitura.

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Vamos trabalhar com microdados do primeiro trimestre de 2023. Para baixar os dados de um trimestre do servidor do IBGE através do pacote .purple[<b>PNADcIBGE</b>], procedemos na forma:</p>

```{r, cache=TRUE, eval=FALSE}
  pnadc_2023q1 <- get_pnadc(year = 2023, quarter = 1)
```

<p class="jst">Lembrando que como se trata de uma quantidade considerável de dados, podemos escolher baixar uma variável específica como a condição de ocupação (<b>VD4002</b>):</p>

```{r, eval=FALSE}
  desocupacao_2023q1 <- get_pnadc(year = 2023, quarter = 1, vars = "VD4002")
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Conforme mencionado, é possível carregar dados da PNAD Contínua diretamente (<i>offline</i>) com a função .purple[read_pnadc()], caso os dados já tenham sido baixados para o computador. Para isso basta informar o arquivo dos microdados (ex: PNADC_012023.txt) e o arquivo de input (um programa de leitura em SAS).</p>

```{r, cache=TRUE, eval=TRUE}
  # Lendo algumas variáveis
  pnadc_2023q1 <- read_pnadc(microdata="../dados/PNADC20231/PNADC_012023.txt",
                             input_txt="../dados/PNADC20231/input_PNADC_trimestral.txt",
                             vars = c("Ano", "Trimestre", "UF", "Capital", 
                                      "V2009", "VD3005", "VD4002"))
  class(pnadc_2023q1)
```

<p class="jst">Nesse caso, os dados serão retornados em um objeto do tipo <b>tibble</b>, sendo necessário aplicar outras operações aos dados para obter labels categóricos em determinadas variáveis, as variáveis de deflacionamento, bem como, transformar o objeto do tipo <b>tibble</b> para <b>survey.design</b> ou <b>svyrep.design</b>, caso seja de interesse obter estatísticas considerando o plano amostral. Essas operações são possíveis através das funções .purple[pnadc_labeller()], .purple[pnadc_deflator()] e  .purple[pnadc_design()] ...</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">... Dessa forma, para obter os labels categóricos, as variáveis de deflacionamento e produzir um objeto do tipo <b>svyrep.design</b> procedemos com:</p>

```{r, cache=TRUE, eval=TRUE}
  # Atribuindo labels as variáveis categóricas
  pnadc_2023q1 <- pnadc_labeller(
    data_pnadc=pnadc_2023q1,
    dictionary.file="../dados/PNADC20231/dicionario_PNADC_microdados_trimestral.xls"
  )
  # Aplicando a deflação nos dados caso deseja-se variáveis de rendimento em valor real.
  pnadc_2023q1 <- pnadc_deflator(
    data_pnadc=pnadc_2023q1,
    deflator.file="../dados/PNADC20231/deflator_PNADC_2023_trimestral_040506.xls"
  )
  # Criação do plano amostral para obter estatísticas coerentes com pacote 'survey'
  pnadc_2023q1 <- pnadc_design(data_pnadc=pnadc_2023q1)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Os arquivos de microdados e auxiliares (input, dicionários, indicadores de deflação) usados para aplicar as operações anteriores são fornecidos pelo IBGE.</p>

<p class="jst">Esses arquivos podem ser obtidos diretamente no servidor <b>ftp</b> do IBGE (<A href="https://ftp.ibge.gov.br">.purple[https://ftp.ibge.gov.br]</A>).</p>

<p class="jst">No entanto, é muito mais comodo obtê-los fazendo uma requisição com a função .purple[get_pnadc()]. Nesse caso, não é necessário procurar os dados desejados na hierarquia de pastas do servidor <b>ftp</b>.</p>

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst">Após as operações realizadas, nosso objeto passa a ser do tipo <b>svyrep.design</b>:</p>

```{r, cache=TRUE, eval=TRUE}
  class(pnadc_2023q1)
```

Esse objeto é uma lista cujos elementos são:

```{r, cache=TRUE, eval=TRUE}
  names(pnadc_2023q1)
```

Os nomes das variáveis podem ser obtidos com:

```{r, cache=TRUE, eval=FALSE}
  names(pnadc_2023q1$variables)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - pacote .purple[<b>PNADcIBGE</b>]]

<p class="jst"> O plano amostral é necessário para obter estatísticas coerentes e métricas sobre essas estatísticas como intervalos de confiança.</p>

Para maiores informações veja os vídeos sobre microdados:

- <A href="https://youtu.be/k3rLK8V_38s">.purple[Vídeo 1 - teórico]</A>

- <A href="https://www.youtube.com/watch?v=qC22jz0FA0U">.purple[Vídeo 2 - sobre PNADC]</A>

- <A href="https://www.youtube.com/watch?v=hhNA8MR__aA">.purple[Vídeo 3 - sobre Pesquisa de Orçamentos Familiares (POF)]</A>


---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

Qual a taxa de Ocupados/Desocupados em nível nacional?

```{r, cache=TRUE}
  svymean(~VD4002, pnadc_2023q1, na.rm=T)
```

Como gerar intervalos de confiança da proporção de Ocupados/Desocupados?

```{r, cache=TRUE}
  confint(svymean(~VD4002, pnadc_2023q1, na.rm=T), level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

Qual a taxa de Ocupados/Desocupados no Rio Grande do Sul?

```{r, cache=TRUE}
  svymean(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T)
```

Como gerar intervalos de confiança da proporção de Ocupados/Desocupados?

```{r, cache=TRUE}
  confint(svymean(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T), level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

Qual o total de Ocupados/Desocupados no Rio Grande do Sul?

```{r, cache=TRUE}
  svytotal(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T)
```

Como gerar intervalos de confiança do total de Ocupados/Desocupados?

```{r, cache=TRUE}
  confint(svytotal(~VD4002, subset(pnadc_2023q1, UF=='Rio Grande do Sul'), na.rm=T), level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

<p class="jst">A variável <b>V2009</b> refere-se a idade dos entrevistados, enquanto <b>VD3005</b> refere-se a quantidade de anos de estudo. Portanto, qual é a média de anos de estudos da população de 25 anos ou mais de idade no Rio Grande do Sul?</p>

```{r, cache=TRUE}
  svymean(~as.numeric(VD3005), 
          subset(pnadc_2023q1, V2009 >= 25, UF=='Rio Grande do Sul'), na.rm = T)
```

```{r, cache=TRUE}
  confint(svymean(~as.numeric(VD3005),
                  subset(pnadc_2023q1, V2009 >= 25, UF=='Rio Grande do Sul'), na.rm = T),
          level=.99)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")` - estatísticas com .purple[<b>survey</b>]]

 Qual é a média de anos de estudos da população de 25 anos ou mais de idade na capital Porto Alegre?
 
```{r, cache=TRUE}
  svymean(~as.numeric(VD3005),
          subset(pnadc_2023q1,
                 V2009 >= 25 & Capital=="Município de Porto Alegre (RS)"), na.rm = T)
```

```{r, cache=TRUE}
  confint(svymean(~as.numeric(VD3005), 
                  subset(pnadc_2023q1,
                         V2009 >= 25 & Capital=="Município de Porto Alegre (RS)"), na.rm = T),
          level=.99)
```
 
---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

Nos próximos exemplos trabalharemos com os seguintes dados:

```{r, eval=FALSE}
  pnadc2023_1trim <- get_pnadc(2023, quarter = 1, design = TRUE, labels = T, 
                             vars = c("Ano","Trimestre","UF", "UPA","Estrato",
                                      "V1028","V2007","V2009","V2010", "V3007",
                                      "VD3004","VD4001", "VD4002","VD4005",
                                      "VD4019", "VD4020","VD4035",
                                      "Habitual", "Efetivo"))
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

Para carregar diretamente:

```{r, eval=TRUE}
  pnadc2023_1trim <- read_pnadc(microdata="../dados/PNADC20231/PNADC_012023.txt",
                             input_txt="../dados/PNADC20231/input_PNADC_trimestral.txt",
                             vars = c("Ano","Trimestre","UF","UPA","Estrato","V1028",
                                      "V2007","V2009","V2010","V3007","VD3004","VD4001",
                                      "VD4002","VD4005","VD4019","VD4020","VD4035"))
  pnadc2023_1trim <- pnadc_labeller(
    data_pnadc=pnadc2023_1trim,
    dictionary.file="../dados/PNADC20231/dicionario_PNADC_microdados_trimestral.xls"
  )
  pnadc2023_1trim <- pnadc_deflator(
    data_pnadc=pnadc2023_1trim,
    deflator.file="../dados/PNADC20231/deflator_PNADC_2023_trimestral_040506.xls"
  )
  pnadc2023_1trim <- pnadc_design(pnadc2023_1trim)
```

---
### .orange[Microdados da PNAD Contínua `r icons::ionicons("bar-chart-outline")`]

<p class="jst">Há uma diversidade de bons materiais que orientam o uso dos microdados da PNAD Contínua através do R: </p>

- <p class="jst">Material <A href="https://rpubs.com/gabriel-assuncao-ibge/pnadc">.purple[online]</A> desenvolvido por um dos criadores do pacote .purple[<b>PNADcIBGE</b>].

- <p class="jst"> Livro  <A href="https://repositorio.ufrn.br/bitstream/123456789/48507/1/PorDentrodaPNADContinua_Trov%C3%A3o_SilvaJ%C3%BAnior_2022.pdf">.purple["POR DENTRO DA PNAD CONTÍNUA: Uma introdução ao tratamento de dados usando o R"]</A>.
- <p class="jst">Curso de R disponível no repositório do Git Hub: <A href="https://github.com/leobarone/cebrap_lab_cetic_programacao_r/tree/master">.purple[Introdução à Programação em R]</b></A>. 
- <p class="jst">Material <A href="https://rpubs.com/amrofi/microdados_pnadc_srvyr/">.purple[online]</A>.

---
exclude: TRUE
class: left, top

### .orange[Referências]

```{r, load_refs, echo=FALSE}
library(RefManageR)
bib <- ReadBib("./files/02-mybib.bib", check = FALSE)
generateReferences <- function(bib) {
  for(i in 1:length(bib)) { 
    print(bib[i], .opts = list(check.entries = FALSE, style = "html", bib.style = "authoryear"))
  }
}
```

```{r, print_refs, results='asis', echo=FALSE, warning=FALSE, message=FALSE}
writeLines('.small[')
generateReferences(bib)
writeLines(']')
```

---
class: center, middle

background-image: url(figures/template_endpage_2.png)
background-size: contain

.center[.large[<b> Metotologias Informacionais com `r icon_style( icons::simple_icons("r"), scale = 2)`</b> ]]

.xxlarge[<b style="color:MidnightBlue "> Muito Obrigado pela Atenção!</b>]
  
